<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Åžirket Stok Takip Sistemi</title>
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --text: #1e293b; }
        body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        .container { max-width: 500px; margin: auto; }
        .header { text-align: center; margin-bottom: 25px; }
        .card { background: white; padding: 20px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 14px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .btn-add { background: var(--primary); color: white; margin-top: 10px; }
        .btn-refresh { background: #10b981; color: white; margin-bottom: 15px; }
        .product-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #f1f5f9; }
        .stock-controls { display: flex; align-items: center; gap: 10px; }
        .btn-small { width: 35px; height: 35px; padding: 0; background: #e2e8f0; border-radius: 50%; color: #475569; font-size: 18px; }
        .loading { text-align: center; color: #64748b; font-style: italic; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>HalÄ± Stok Otomasyonu</h2>
        <p>Ortak Åžirket AÄŸÄ±</p>
    </div>

    <div class="card">
        <input type="text" id="pName" placeholder="ÃœrÃ¼n AdÄ± (Ã–rn: Mutfak HalÄ±sÄ±)">
        <input type="number" id="pStock" placeholder="BaÅŸlangÄ±Ã§ StoÄŸu">
        <input type="text" id="pPrice" placeholder="Fiyat (TL)">
        <button class="btn-add" onclick="addProduct()">Yeni ÃœrÃ¼n Ekle</button>
    </div>

    <button class="btn-refresh" onclick="loadData()">ðŸ”„ Listeyi GÃ¼ncelle</button>

    <div id="loading" class="loading" style="display:none;">Senkronize ediliyor...</div>
    
    <div id="productList" class="card">
        <p style="text-align:center;">YÃ¼kleniyor...</p>
    </div>
</div>

<script>
    // SON GÃ–NDERDÄ°ÄžÄ°N DOÄžRU SCRIPT URL
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxjEiApQAsoN4A-l6GWrxkN-7VTa6LW32RkJg1nzjgxE1lWkgv0db1Zr_aVxxleeHAH/exec';
    
    let products = [];

    // Google Tablo'dan Veri Ã‡ekme
    async function loadData() {
        document.getElementById('loading').style.display = 'block';
        try {
            const response = await fetch(WEB_APP_URL);
            products = await response.json();
            renderProducts();
        } catch (error) {
            console.error("Hata:", error);
        }
        document.getElementById('loading').style.display = 'none';
    }

    // Google Tablo'ya Veri GÃ¶nderme
    async function saveData() {
        document.getElementById('loading').style.display = 'block';
        try {
            await fetch(WEB_APP_URL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify(products)
            });
            // Veri yazÄ±ldÄ±ktan kÄ±sa sÃ¼re sonra listeyi yenile
            setTimeout(loadData, 2000);
        } catch (error) {
            alert("BaÄŸlantÄ± hatasÄ±!");
        }
    }

    function renderProducts() {
        const list = document.getElementById('productList');
        list.innerHTML = products.length === 0 ? "HenÃ¼z Ã¼rÃ¼n yok." : "";
        products.forEach((p, index) => {
            list.innerHTML += `
                <div class="product-item">
                    <div>
                        <strong>${p.name}</strong><br>
                        <small>${p.price} TL</small>
                    </div>
                    <div class="stock-controls">
                        <button class="btn-small" onclick="updateStock(${index}, -1)">-</button>
                        <span><b>${p.stock}</b></span>
                        <button class="btn-small" onclick="updateStock(${index}, 1)">+</button>
                    </div>
                </div>`;
        });
    }

    async function addProduct() {
        const name = document.getElementById('pName').value;
        const stock = document.getElementById('pStock').value;
        const price = document.getElementById('pPrice').value;

        if(name && stock && price) {
            products.push({ id: Date.now(), name, stock: parseInt(stock), price });
            await saveData();
            document.getElementById('pName').value = '';
            document.getElementById('pStock').value = '';
            document.getElementById('pPrice').value = '';
        } else {
            alert("LÃ¼tfen tÃ¼m alanlarÄ± doldurun.");
        }
    }

    async function updateStock(index, change) {
        products[index].stock = Math.max(0, parseInt(products[index].stock) + change);
        renderProducts();
        await saveData();
    }

    // Ä°lk aÃ§Ä±lÄ±ÅŸta verileri Ã§ek
    loadData();
</script>

</body>
</html>
